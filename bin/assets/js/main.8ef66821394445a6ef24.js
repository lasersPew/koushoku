!function(){"use strict";function o(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}function f(){var e=document.querySelectorAll(".zoom-in"),t=document.querySelectorAll(".zoom-out"),n=document.querySelectorAll(".toggle-settings");e.forEach(function(e){e.dataset.attached||(e.dataset.attached="true",e.addEventListener("click",function(){var e=(m.zoomLevel+.1).toFixed(1);y("zoomLevel",Math.max(.1,Number(e))),S()}))}),t.forEach(function(e){e.dataset.attached||(e.dataset.attached="true",e.addEventListener("click",function(){var e=(m.zoomLevel-.1).toFixed(1);y("zoomLevel",Math.min(2,Number(e))),S()}))}),n.forEach(function(e){e.dataset.attached||(e.dataset.attached="true",e.addEventListener("click",function(){return b()}))})}function c(e){if(!w.current){w.current=!0;try{var t;l=e,s.find(function(e){return e.isViewing}).isViewing=!1,s[l-1].isViewing=!0,m.mode===n.Normal&&(r.href="/archive/".concat(a,"/").concat(i,"/").concat(l),(t=document.createElement("img")).src="".concat(p,"/data/").concat(a,"/").concat(l,".jpg"),u.replaceWith(t),u=t),h.forEach(function(e){return e.textContent=l.toString()}),window.history.replaceState(null,"","/archive/".concat(a,"/").concat(i,"/").concat(l)),g.forEach(function(e){return e.href="/archive/".concat(a,"/").concat(i,"/").concat(l-1)}),E.forEach(function(e){return e.href="/archive/".concat(a,"/").concat(i,"/").concat(l+1)})}finally{w.current=!1}}}function v(){for(var t=s.findIndex(function(e){return e.isViewing}),c=0,e=function(e){var n=s[e];if(n.isPreloading||n.isPreloaded||e<Math.max(0,t-x)||e>Math.min(s.length,t+x))return"continue";var o=e+1;n.isPreloading=!0,setTimeout(function(){function e(){n.isPreloading=!1,n.isPreloaded=!0}var t=document.createElement("img");t.src="".concat(p,"/data/").concat(a,"/").concat(o,".jpg");t.complete?e():(t.addEventListener("load",e),t.addEventListener("error",function(){return n.isPreloading=!1}))},1e3*c),c++},n=0;n<s.length;n++)e(n)}function e(){"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(e){for(var t=0;t<e.length;t++)e[t].unregister()});var e,t,n=document.getElementById("reader");n&&(a=document.body.dataset.id,i=document.body.dataset.slug,d=Number(document.body.dataset.totalPages),h=document.querySelectorAll(".current"),l=Number(h[0].textContent),s.push.apply(s,Array.from({length:d},function(e,t){return{isViewing:t+1===l}})),r=n.querySelector(".page a"),u=r.querySelector("img"),p=new URL(u.src).origin,document.querySelectorAll(".first").forEach(function(e){e.addEventListener("click",function(e){o(e),1<l&&c(1)})}),document.querySelectorAll(".last").forEach(function(e){e.addEventListener("click",function(e){o(e),l<d&&c(d)})}),(g=document.querySelectorAll(".prev")).forEach(function(e){e.addEventListener("click",function(e){o(e),1<l&&c(l-1)})}),(E=document.querySelectorAll(".next")).forEach(function(e){e.addEventListener("click",function(e){o(e),l<d&&c(l+1)})}),r.addEventListener("click",function(e){o(e);var t=e.target,e=e.offsetX<=t.clientWidth*m.zoomLevel/2;e&&1<l?c(l-1):!e&&l<d&&c(l+1)}),e=0,t=function(){clearInterval(e),e=window.setInterval(function(){window.requestAnimationFrame(function(){u.naturalHeight&&(clearInterval(e),r.scrollIntoView({block:"start",inline:"start"}))})},10)},new MutationObserver(function(){t(),v()}).observe(r,{childList:!0}),window.addEventListener("keydown",function(e){1<l&&("ArrowLeft"===e.code||"KeyA"===e.code||"KeyH"===e.code)?c(l-1):l<d&&("ArrowRight"===e.code||"KeyD"===e.code||"KeyL"===e.code)&&c(l+1)}),(n=localStorage.getItem("settings"))?(n=JSON.parse(n),Object.assign(m,n)):L(),S(),f(),t(),v())}(t=n=n||{})[t.Normal=0]="Normal",t[t.Strip=1]="Strip";var n,t,a,i,p,r,d,h,l,u,g,E,m={mode:0,maxWidth:1366,zoomLevel:1},L=function(){localStorage.setItem("settings",JSON.stringify(m))},y=function(e,t){e in m&&("zoomLevel"!==e||!(t<.1||5<t))&&(m[e]=t,L())},s=[],x=3,w={current:!1},S=function(){0<m.maxWidth?r.style.maxWidth="".concat(m.maxWidth,"px"):r.style.maxWidth="",0<m.zoomLevel?r.style.zoom="".concat(m.zoomLevel):r.style.zoom="";var e=r.firstElementChild;1<m.zoomLevel?e.style.maxWidth="".concat(window.innerWidth*m.zoomLevel,"px"):e.style.maxWidth="",document.querySelectorAll(".zoom-level").forEach(function(e){e.innerText="".concat((100*m.zoomLevel).toFixed(),"%")})},b=function(){var e,t,u,s,n,o,c,a,i,r,d,l;document.getElementById("settings-popup")||((e=document.createElement("div")).id="settings-popup",(t=document.createElement("div")).addEventListener("click",function(){return e.remove()}),t.classList.add("settings-overlay"),(u=document.createElement("div")).classList.add("settings-content"),(s=document.createElement("div")).classList.add("settings-header"),(n=document.createElement("span")).textContent="Settings",s.appendChild(n),(n=document.createElement("div")).classList.add("settings-container"),(o=document.createElement("div")).classList.add("settings-section"),(c=document.createElement("span")).textContent="Zoom",a=document.createElement("div"),(i=document.createElement("button")).type="button",i.textContent="-",i.classList.add("zoom-out"),(l=document.createElement("span")).textContent="".concat((100*m.zoomLevel).toFixed(),"%"),l.classList.add("zoom-level"),(d=document.createElement("button")).type="button",d.textContent="+",d.classList.add("zoom-in"),a.append(i,l,d),o.append(c,a),n.appendChild(o),(o=document.createElement("div")).classList.add("settings-section","max-width"),(c=document.createElement("span")).textContent="Max. width",a=document.createElement("div"),(i=document.createElement("div")).classList.add("wrapper"),(r=document.createElement("input")).type="number",r.min="0",r.defaultValue=m.maxWidth.toString(),r.addEventListener("change",function(){var e=Number(r.value);Number.isNaN(e)&&(r.value="0"),m.maxWidth!==e&&(y("maxWidth",e),S())}),(l=document.createElement("span")).textContent="px",i.append(r,l),a.append(i),o.append(c,a),n.appendChild(o),(d=document.createElement("div")).classList.add("footer"),(l=document.createElement("button")).classList.add("close"),l.type="button",l.textContent="Close",l.addEventListener("click",function(){return e.remove()}),d.appendChild(l),n.appendChild(d),u.append(s,n),e.append(t,u),document.body.appendChild(e),f())};"complete"===document.readyState?e():document.addEventListener("DOMContentLoaded",e)}();