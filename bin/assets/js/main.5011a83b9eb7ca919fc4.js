!function(){"use strict";function t(){var n,o,r,t,l,c,s,i,a,u,f,d,e,g,p;"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(t){for(var e=0;e<t.length;e++)t[e].unregister()}),(p=document.getElementById("reader"))&&(t=window.location.pathname.split("/"),m=t[2],v=t[3],n=Number(document.querySelector(".total").textContent),o=document.querySelectorAll(".current"),r=Number(o[0].textContent),t=document.querySelectorAll(".first"),l=document.querySelectorAll(".last"),c=document.querySelectorAll(".prev"),s=document.querySelectorAll(".next"),i=p.querySelector(".page a"),a=i.querySelector("img"),h=new URL(a.src).origin,u={current:!1},f=i.getBoundingClientRect(),w.push.apply(w,Array.from({length:n},function(t,e){return{isViewing:e+1===r}})),d=function(t){if(!u.current){u.current=!0;try{r=t,w.find(function(t){return t.isViewing}).isViewing=!1,w[r-1].isViewing=!0,i.href="/archive/".concat(m,"/").concat(v,"/").concat(r);var e=document.createElement("img");e.src="".concat(h,"/data/").concat(m,"/").concat(r,".jpg"),a.replaceWith(e),a=e,o.forEach(function(t){return t.textContent=r.toString()}),window.history.replaceState(null,"","/archive/".concat(m,"/").concat(v,"/").concat(r)),c.forEach(function(t){t.href="/archive/".concat(m,"/").concat(v,"/").concat(r-1)}),s.forEach(function(t){t.href="/archive/".concat(m,"/").concat(v,"/").concat(r+1)})}finally{u.current=!1}}},t.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),1!==r&&d(1)})}),l.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),r!==n&&d(n)})}),c.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),1!==r&&d(r-1)})}),s.forEach(function(t){t.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),r!==n&&d(r+1)})}),i.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();var e=t.target;t.screenX-f.x<=e.clientWidth/2?1!==r&&d(r-1):r!==n&&d(r+1)}),e=0,(g=function(){clearInterval(e),e=window.setInterval(function(){window.requestAnimationFrame(function(){a.naturalHeight&&(clearInterval(e),i.scrollIntoView({block:"start",inline:"start"}))})},10)})(),new MutationObserver(function(){g(),y()}).observe(i,{childList:!0,attributes:!0}),y(),window.addEventListener("keydown",function(t){"ArrowLeft"===t.code||"KeyA"===t.code||"KeyH"===t.code?1!==r&&d(r-1):"ArrowRight"!==t.code&&"KeyD"!==t.code&&"KeyL"!==t.code||r!==n&&d(r+1)}))}var m,v,h,w=[],y=function(){for(var r=w.findIndex(function(t){return t.isViewing}),t=function(t){var e=w[t];if(e.isPreloading||e.isPreloaded||t<Math.max(0,r-3)||t>Math.min(w.length,r+3))return"continue";e.isPreloading=!0;function n(){e.isPreloading=!1,e.isPreloaded=!0}var o=document.createElement("img");o.src="".concat(h,"/data/").concat(m,"/").concat(t+1,".jpg");o.complete?n():(o.addEventListener("load",n),o.addEventListener("error",function(){return e.isPreloading=!1}))},e=0;e<w.length;e++)t(e)};"complete"===document.readyState?t():document.addEventListener("DOMContentLoaded",t)}();