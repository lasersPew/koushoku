!function(){"use strict";function e(){var n,c,r,e,l,f,s,o,i,a,g,u,d,t,v,h;"serviceWorker"in navigator&&navigator.serviceWorker.getRegistrations().then(function(e){for(var t=0;t<e.length;t++)e[t].unregister()}),(h=document.getElementById("reader"))&&(e=window.location.pathname.split("/"),m=e[2],w=e[3],n=Number(document.querySelector(".total").textContent),c=document.querySelectorAll(".current"),r=Number(c[0].textContent),e=document.querySelectorAll(".first"),l=document.querySelectorAll(".last"),f=document.querySelectorAll(".prev"),s=document.querySelectorAll(".next"),o=h.querySelector(".page a"),i=o.querySelector("img"),y=new URL(i.src).origin,a={current:!1},g=o.getBoundingClientRect(),E.push.apply(E,Array.from({length:n},function(e,t){return{isViewing:t+1===r}})),u=function(e){if(!a.current){a.current=!0;try{r=e,E.find(function(e){return e.isViewing}).isViewing=!1,E[r-1].isViewing=!0,o.href="/archive/".concat(m,"/").concat(w,"/").concat(r);var t=document.createElement("img");t.src="".concat(y,"/data/").concat(m,"/").concat(r,".jpg"),i.replaceWith(t),i=t,c.forEach(function(e){return e.textContent=r.toString()}),window.history.replaceState(null,"","/archive/".concat(m,"/").concat(w,"/").concat(r)),f.forEach(function(e){e.href="/archive/".concat(m,"/").concat(w,"/").concat(r-1)}),s.forEach(function(e){e.href="/archive/".concat(m,"/").concat(w,"/").concat(r+1)})}finally{a.current=!1}}},d=function(e){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()},e.forEach(function(e){e.addEventListener("click",function(e){d(e),1<r&&u(1)})}),l.forEach(function(e){e.addEventListener("click",function(e){d(e),r<n&&u(n)})}),f.forEach(function(e){e.addEventListener("click",function(e){d(e),1<r&&u(r-1)})}),s.forEach(function(e){e.addEventListener("click",function(e){d(e),r<n&&u(r+1)})}),o.addEventListener("click",function(e){d(e);var t=e.target;e.screenX-g.x<=t.clientWidth/2?1<r&&u(r-1):r<n&&u(r+1)}),t=0,(v=function(){clearInterval(t),t=window.setInterval(function(){window.requestAnimationFrame(function(){i.naturalHeight&&(clearInterval(t),o.scrollIntoView({block:"start",inline:"start"}))})},10)})(),new MutationObserver(function(){v(),p()}).observe(o,{childList:!0,attributes:!0}),p(),window.addEventListener("keydown",function(e){"ArrowLeft"===e.code||"KeyA"===e.code||"KeyH"===e.code?1<r&&u(r-1):r<n&&("ArrowRight"===e.code||"KeyD"===e.code||"KeyL"===e.code)&&u(r+1)}))}var m,w,y,E=[],p=function(){for(var r=E.findIndex(function(e){return e.isViewing}),e=function(e){var t=E[e];if(t.isPreloading||t.isPreloaded||e<Math.max(0,r-3)||e>Math.min(E.length,r+3))return"continue";t.isPreloading=!0;function n(){t.isPreloading=!1,t.isPreloaded=!0}var c=document.createElement("img");c.src="".concat(y,"/data/").concat(m,"/").concat(e+1,".jpg");c.complete?n():(c.addEventListener("load",n),c.addEventListener("error",function(){return t.isPreloading=!1}))},t=0;t<E.length;t++)e(t)};"complete"===document.readyState?e():document.addEventListener("DOMContentLoaded",e)}();